<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<title>Backups</title>
	<meta name="version" content="S5 1.0" />
	<link rel="stylesheet" href="ui/slides.css" type="text/css" media="projection" id="slideProj" />
	<link rel="stylesheet" href="ui/opera.css" type="text/css" media="projection" id="operaFix" />
	<link rel="stylesheet" href="ui/print.css" type="text/css" media="print" id="slidePrint" />
	<script src="ui/slides.js" type="text/javascript"></script>
</head>
<body>

<div class="layout">
	<div id="currentSlide"></div>
	<div id="background"></div>
	<div id="header"></div>
	<div id="footer">
		<h1>St. John's Linux Users Group &#8226; March 17, 2005</h1>
		<h2>Backups</h2>
		<div id="controls"></div>
	</div>
</div>


<div class="presentation">

<div class="slide">
	<h1>Backups</h1>
	<h3><a href="http://www.geoffholden.com">Geoff Holden</a></h3>
	<h4><a href="mailto:gholden&#64;ieee.org">gholden&#64;ieee.org</a></h4>
	<h4><a href="http://www.slug.nf.net">St. John's Linux Users Group</a></h4>
</div>


<div class="slide">
	<h1>Why Backup?</h1>
	<ul>
		<li>Accidental Deletion/Modification</li>
		<li>System Compromise</li>
		<li>A Hard Drive exists in only two states: failed, and about to fail.</li>
	</ul>
	<div class="handout">
	</div>
</div>

<div class="slide">
	<h1>What Should I Backup?</h1>
	<ul>
		<li>Documents</li>
		<li>Source Code</li>
		<li>Digital Photos</li>
		<li>Bookmarks</li>
		<li>Config Files (/etc)</li>
		<li>Address Book</li>
		<li>Digital Music</li>
		<li>Anything else non-replaceable</li>
	</ul>
	<div class="handout">
	</div>
</div>

<div class="slide">
	<h1>Types of Backups</h1>
	<dl>
		<dt>Complete/Archival</dt>
		<dd>
			A full backup of everything that you back up. System can be restored from
			this backup.
		</dd>

		<dt>Differential Incremental (Incremental)</dt>
		<dd>
			Backup of all files modified since the last of either a complete backup,
			or another incremental.
			System can be restored from the complete, and then each of the incrementals in order.
		</dd>

		<dt>Cumulative Incremental (Differential)</dt>
		<dd>
			Backup of all files modified since the last complete backup.
			System can be restored from the complete, and then the most recent incremental.
		</dd>
	</dl>
	<div class="handout">
	</div>
</div>

<div class="slide">
	<h1>What Should I Store My Backups On?</h1>
	<table>
		<tr>
			<th>Media</th>
			<th>Price</th>
			<th>Capacity</th>
			<th>Rewritable</th>
		</tr>
		<tr>
			<td>CD-R</td>
			<td>59&#162;/GB</td>
			<td>Low (700MB/ea)</td>
			<td>No</td>
		</tr>
		<tr>
			<td>DVD-R</td>
			<td>21&#162;/GB</td>
			<td>Med (4.7GB/ea)</td>
			<td>No</td>
		</tr>
		<tr>
			<td>Tape</td>
			<td>36&#162;/GB</td>
			<td>Med-High (36GB-160GB)</td>
			<td>Yes</td>
		</tr>
		<tr>
			<td>Hard Drive(s)</td>
			<td>80&#162;/GB</td>
			<td>High (200GB+)</td>
			<td>Yes</td>
		</tr>
	</table>
	<div class="handout">
	</div>
</div>

<div class="slide">
	<h1>Where should I store my backups?</h1>
	<dl>
		<dt>Separate Directory</dt>
		<dd>
			This protects you from accidental deletion/modification, and not much else.
		</dd>

		<dt>Separate Filesystem</dt>
		<dd>
			Better than above, because you're protected from filesystem corruption, and
			you have the option of leaving the backup unmounted (or mounted read-only)
			most of the time.
		</dd>

		<dt>Separate Disk</dt>
		<dd>
			Even better again &mdash; protected against disk failure.
		</dd>

		<dt>Separate Server</dt>
		<dd>
			Protected against a massive failure of the production server.
			(Even better in a remote location)
		</dd>
	</dl>
	<div class="handout">
	</div>
</div>

<div class="slide">
	<h1>Backup Programs</h1>
	<dl>
		<dt>dump/restore</dt>
		<dd>
			<span style="font-style: italic;">&ldquo;anybody who
				depends on &ldquo;dump&rdquo; getting backups right is already playing
				Russian roulette with their backups.&rdquo;</span>
			<br />
			&mdash;Linus Torvalds
		</dd>

		<dt>AMANDA</dt>
		<dd>
			The Advanced Maryland Automatic Network Disk Archiver, a client/server backup
			application where a single backup server can back up many clients.
		</dd>

		<dt>tar</dt>
		<dd>
			Tape ARchiver, the &ldquo;standard&rdquo; archiver on a Linux system.
		</dd>
	</dl>
	<div class="handout">
		<h2>Full quote on dump/restore</h2>
		<blockquote>
			<p>
				Note that dump simply won't work reliably at all even in 2.4.x: the buffer
				cache and the page cache (where all the actual data is) are not
				coherent. This is only going to get even worse in 2.5.x, when the
				directories are moved into the page cache as well.
			</p>

			<p>
				So anybody who depends on "dump" getting backups right is already playing
				Russian roulette with their backups.  It's not at all guaranteed to get the
				right results - you may end up having stale data in the buffer cache that
				ends up being "backed up".
			</p>
			<p>Linus Torvalds</p>
		</blockquote>
	</div>
</div>


<div class="slide">
	<h1>Backup Programs</h1>
	<dl>
		<dt>Dar &amp; KDar</dt>
		<dd>
			Disk ARchive, a shell command (and KDE frontend) for backing up directory
			trees and files.
		</dd>

		<dt>rsync</dt>
		<dd>Fast incremental file transfer program.</dd>

		<dt>Partimage</dt>
		<dd>Partition imager (think Norton Ghost, but free)</dd>
	</dl>
</div>

<div class="slide">
	<h1>AMANDA</h1>
	<ul>
		<li>Very mature project, with good documentation.</li>
		<li>Uses dump or tar to do the actual backups.</li>
		<li>Runs via cron on the server-side, and inetd/xinetd on the client.</li>
		<li>Originally meant for tapes, but it does have a file driver.</li>
	</ul>
</div>

<div class="slide">
	<h1>Dar &amp; KDar</h1>
	<ul>
		<li>Intended to be able to split an archive over several pieces of removable
			media (floppies, CD-Rs, DVD-Rs, etc).</li>
		<li>Supports compression (gzip, bzip2).</li>
		<li>Faster than tar for restoring a single file (has an index into the file).</li>
		<li>Supports differential backups.</li>
		<li>Has a nice, easy frontend for KDE.
			(that can generate the dar shell script for you)</li>
	</ul>
</div>

<div class="slide">
	<h1>rsync</h1>
	<ul>
		<li>Can update whole directory trees and filesystems.</li>
		<li>Can preserve symbolic links, hard links, file ownership,
			permissions, devices and times.</li>
		<li>Can use rsh, ssh or direct sockets as the transport.</li>
		<li>Can make incremental backups using some clever shell scripts
			or 3<sup>rd</sup> party programs (rsnapshot, RsyncBackup, etc)</li>
	</ul>
</div>

<div class="slide">
	<h1>Partimage</h1>
	<ul>
		<li>Useful for making a full image of a system.</li>
		<li>Cannot restore a single file, so it's not really suited for
			document backups.</li>
		<li>Can operate in client/server mode.</li>
		<li>I use it to backup Windows systems that tend to be destroyed/infected
			with viruses, for easy rebuilding.</li>
	</ul>
</div>


<div class="slide">
	<h1>My Rsync Backup Script</h1>
<pre><code>#!/bin/sh

BACKUPS=7

# Remount in R/W mode
mount /backup -o remount,rw

# Delete old backup
rm -rf /backup/backup.$(($BACKUPS-1))

# Increment backup ID
for i in $(seq $(($BACKUPS-2)) -1 0); do
    mv /backup/backup.$i /backup/backup.$(($i+1))
done

# Make next backup
rsync -a --delete --link-dest=../backup.1 /home/ /backup/backup.0/

# Remount in R/O mode
mount /backup -o remount,ro
</code></pre>
</div>

<div class="slide">
	<h1>Links/References</h1>
	<ul>
		<li>AMANDA &mdash; <a href="http://www.amanda.org">http://www.amanda.org</a></li>
		<li>Dar &mdash; <a href="http://dar.sourceforge.net">http://dar.sourceforge.net</a></li>
		<li>KDar &mdash; <a href="http://kdar.sourceforge.net">http://kdar.sourceforge.net</a></li>
		<li>rsync &mdash; <a href="http://rsync.samba.org">http://rsync.samba.org</a></li>
		<li>Easy Automated Snapshot-Style Backups with Linux and Rsync&nbsp;&mdash;
			<a href="http://www.mikerubel.org/computers/rsync_snapshots/" style="font-size: 80%">
			http://www.mikerubel.org/computers/rsync_snapshots/</a></li>
		<li>Windows Client Backups with rsync and FreeBSD&nbsp;&mdash;
			<a href="http://www.samag.com/documents/s=9338/sam0410a/0410a.htm" style="font-size: 80%">
			http://www.samag.com/documents/s=9338/sam0410a/0410a.htm</a></li>
	</ul>
</div>

</div>

</body>
</html>
